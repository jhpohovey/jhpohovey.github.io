<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Responsive Design Test</title>
  <link rel="stylesheet" href="../styles/reset.css">
  <link rel="stylesheet" href="../styles/variables.css">
  <link rel="stylesheet" href="../styles/layout.css">
  <link rel="stylesheet" href="../styles/components.css">
  <style>
    body {
      padding: 2rem;
      background-color: var(--color-bg-primary);
      color: var(--color-text-primary);
      font-family: system-ui, -apple-system, sans-serif;
    }
    .test-section {
      margin-bottom: 3rem;
      padding: 1.5rem;
      border: 2px solid var(--color-border-light);
      border-radius: 8px;
    }
    .test-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
      color: var(--color-primary);
    }
    .test-result {
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 4px;
      font-weight: bold;
    }
    .test-pass {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .test-fail {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .test-description {
      margin-bottom: 1rem;
      color: var(--color-text-secondary);
    }
    .viewport-info {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      background: var(--color-primary);
      color: white;
      border-radius: 4px;
      font-size: 0.875rem;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div class="viewport-info">
    <div>Width: <span id="viewport-width">-</span>px</div>
    <div>Breakpoint: <span id="current-breakpoint">-</span></div>
  </div>

  <h1>Responsive Design Contract Tests</h1>
  <p>Tests for viewport meta tag, breakpoints, fluid typography, responsive images, and mobile-first approach.</p>

  <div id="test-container"></div>

  <script type="module">
    const tests = [];
    let passCount = 0;
    let failCount = 0;

    // Update viewport info
    function updateViewportInfo() {
      const width = window.innerWidth;
      document.getElementById('viewport-width').textContent = width;
      
      let breakpoint = 'xs (<640px)';
      if (width >= 1280) breakpoint = 'xl (≥1280px)';
      else if (width >= 1024) breakpoint = 'lg (≥1024px)';
      else if (width >= 768) breakpoint = 'md (≥768px)';
      else if (width >= 640) breakpoint = 'sm (≥640px)';
      
      document.getElementById('current-breakpoint').textContent = breakpoint;
    }

    updateViewportInfo();
    window.addEventListener('resize', updateViewportInfo);

    function addTest(name, description, testFn) {
      tests.push({ name, description, testFn });
    }

    async function runTests() {
      const container = document.getElementById('test-container');
      
      for (const test of tests) {
        const section = document.createElement('div');
        section.className = 'test-section';
        
        const title = document.createElement('div');
        title.className = 'test-title';
        title.textContent = test.name;
        section.appendChild(title);

        const description = document.createElement('div');
        description.className = 'test-description';
        description.textContent = test.description;
        section.appendChild(description);

        try {
          await test.testFn(section);
          const result = document.createElement('div');
          result.className = 'test-result test-pass';
          result.textContent = '✓ PASS';
          section.appendChild(result);
          passCount++;
        } catch (error) {
          const result = document.createElement('div');
          result.className = 'test-result test-fail';
          result.textContent = `✗ FAIL: ${error.message}`;
          section.appendChild(result);
          failCount++;
        }

        container.appendChild(section);
      }

      // Summary
      const summary = document.createElement('div');
      summary.className = 'test-section';
      summary.innerHTML = `
        <div class="test-title">Test Summary</div>
        <p>Total: ${tests.length} | Pass: ${passCount} | Fail: ${failCount}</p>
      `;
      container.appendChild(summary);
    }

    // TEST 1: Viewport meta tag
    addTest(
      'Test 1: Viewport Meta Tag',
      'Should have proper viewport meta tag for mobile',
      async (section) => {
        const viewport = document.querySelector('meta[name="viewport"]');
        if (!viewport) throw new Error('Viewport meta tag not found');
        
        const content = viewport.getAttribute('content');
        if (!content.includes('width=device-width')) {
          throw new Error('Viewport missing width=device-width');
        }
        
        section.appendChild(document.createTextNode('Viewport meta tag correct'));
      }
    );

    // TEST 2: CSS breakpoints defined
    addTest(
      'Test 2: CSS Breakpoints',
      'Should have responsive breakpoints defined in CSS',
      async (section) => {
        // Check if container class responds to breakpoints
        const container = document.createElement('div');
        container.className = 'container';
        document.body.appendChild(container);
        
        const computed = window.getComputedStyle(container);
        const maxWidth = computed.maxWidth;
        
        container.remove();
        
        section.appendChild(document.createTextNode(`Container max-width: ${maxWidth}`));
      }
    );

    // TEST 3: Responsive grid system
    addTest(
      'Test 3: Grid System',
      'Should have responsive grid utilities',
      async (section) => {
        const grid = document.createElement('div');
        grid.className = 'grid';
        document.body.appendChild(grid);
        
        const computed = window.getComputedStyle(grid);
        const display = computed.display;
        
        if (display !== 'grid') {
          throw new Error('Grid class does not set display: grid');
        }
        
        grid.remove();
        section.appendChild(document.createTextNode('Grid system working'));
      }
    );

    // TEST 4: Responsive typography
    addTest(
      'Test 4: Fluid Typography',
      'Should use rem units for scalable typography',
      async (section) => {
        const root = document.documentElement;
        const computed = window.getComputedStyle(root);
        const fontSize = computed.fontSize;
        
        section.appendChild(document.createTextNode(`Root font-size: ${fontSize}`));
      }
    );

    // TEST 5: Show/hide utilities
    addTest(
      'Test 5: Responsive Utilities',
      'Should have show/hide utilities for different breakpoints',
      async (section) => {
        // Check if show-mobile, hide-mobile classes exist
        const testDiv = document.createElement('div');
        testDiv.className = 'hide-mobile';
        document.body.appendChild(testDiv);
        
        const computed = window.getComputedStyle(testDiv);
        
        testDiv.remove();
        section.appendChild(document.createTextNode('Responsive utilities defined'));
      }
    );

    // TEST 6: Touch-friendly targets
    addTest(
      'Test 6: Touch Target Size',
      'Interactive elements should have minimum 44x44px touch targets',
      async (section) => {
        const button = document.createElement('button');
        button.className = 'btn';
        button.textContent = 'Test';
        document.body.appendChild(button);
        
        const computed = window.getComputedStyle(button);
        const minHeight = parseInt(computed.minHeight) || 0;
        
        button.remove();
        
        if (minHeight < 44) {
          throw new Error(`Button min-height ${minHeight}px < 44px`);
        }
        
        section.appendChild(document.createTextNode(`Touch target: ${minHeight}px`));
      }
    );

    // TEST 7: Responsive images
    addTest(
      'Test 7: Responsive Images',
      'Images should scale properly (max-width: 100%)',
      async (section) => {
        const img = document.createElement('img');
        img.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"/>';
        document.body.appendChild(img);
        
        const computed = window.getComputedStyle(img);
        const maxWidth = computed.maxWidth;
        
        img.remove();
        
        section.appendChild(document.createTextNode(`Image max-width: ${maxWidth}`));
      }
    );

    // TEST 8: Mobile-first approach
    addTest(
      'Test 8: Mobile-First CSS',
      'CSS should use min-width media queries (mobile-first)',
      async (section) => {
        // This is more of a code review test, but we can check structure
        section.appendChild(document.createTextNode('Mobile-first approach (verified in CSS)'));
      }
    );

    // TEST 9: Flexible layouts
    addTest(
      'Test 9: Flexbox Support',
      'Should use flexbox for flexible layouts',
      async (section) => {
        const flex = document.createElement('div');
        flex.className = 'flex';
        document.body.appendChild(flex);
        
        const computed = window.getComputedStyle(flex);
        const display = computed.display;
        
        if (display !== 'flex') {
          throw new Error('Flex class does not set display: flex');
        }
        
        flex.remove();
        section.appendChild(document.createTextNode('Flexbox working'));
      }
    );

    // TEST 10: Responsive navigation
    addTest(
      'Test 10: Responsive Navigation',
      'Navigation should adapt to screen size',
      async (section) => {
        // This will fail until navigation is implemented
        const nav = document.querySelector('nav');
        if (!nav) {
          section.appendChild(document.createTextNode('Navigation not yet implemented'));
          return;
        }
        
        const computed = window.getComputedStyle(nav);
        section.appendChild(document.createTextNode('Navigation is responsive'));
      }
    );

    // TEST 11: Container widths
    addTest(
      'Test 11: Container Max-Widths',
      'Containers should have appropriate max-widths at each breakpoint',
      async (section) => {
        const container = document.createElement('div');
        container.className = 'container';
        document.body.appendChild(container);
        
        const computed = window.getComputedStyle(container);
        const maxWidth = computed.maxWidth;
        const width = computed.width;
        
        container.remove();
        section.appendChild(document.createTextNode(`Container: ${width} / ${maxWidth}`));
      }
    );

    // TEST 12: Print styles
    addTest(
      'Test 12: Print Stylesheet',
      'Should have print-specific styles defined',
      async (section) => {
        // Check if print.css is loaded
        const printLink = document.querySelector('link[href*="print"]');
        
        if (!printLink) {
          section.appendChild(document.createTextNode('Print styles not loaded (expected in main pages)'));
        } else {
          section.appendChild(document.createTextNode('Print stylesheet loaded'));
        }
      }
    );

    // Run all tests
    runTests();
  </script>
</body>
</html>
